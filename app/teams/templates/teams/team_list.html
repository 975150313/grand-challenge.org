{% extends "site.html" %}
{% load url from comic_templatetags %}
{% load get_obj_perms from guardian_tags %}

{% block pagecontent %}

    <h2>Teams</h2>

    <p>Teams are groups of users who compete together in a challenge.</p>

    {% if member_of %}

        <p>You are already a member of the following teams: </p>

        <dl>
            {% for tm in member_of %}
                <dt>Team</dt>
                <dd>
                    <a href="{{ tm.team.get_absolute_url }}">{{ tm.team.name }}</a>
                </dd>

                {% get_obj_perms user for tm.team as "team_perms" %}
                {% if "change_team" in team_perms %}
                    <dd>
                        <a href="{% url 'teams:update' site.short_name tm.team.pk %}"
                           class="btn btn-primary">Edit
                            Team</a>
                    </dd>
                {% endif %}
                <dd>
                    <form method="post"
                          action="{% url 'teams:member-delete' site.short_name tm.pk %}">
                        {% csrf_token %}
                        <button type="submit"
                                class="btn btn-danger">
                            Leave Team
                        </button>
                    </form>
                </dd>
            {% endfor %}
        </dl>

        <p>You must leave these teams before you can join another team. The
            teams competing in {{ site.short_name }} are: </p>

    {% else %}

        <p>
            <a class="btn btn-primary"
               href="{% url 'teams:create' site.short_name %}">Create a new
                team for {{ site.short_name }}</a>
        </p>

        <p>Or, you can request to join an existing team: </p>

    {% endif %}


    <table class="table" id="teamsTable">
        <thead>
        <tr>
            <th>Team Name</th>
            <th>Number of Members</th>
            {% if not member_of %}
                <th>Join Team</th>
            {% endif %}
        </tr>
        </thead>
        <tbody>
        {% for team in object_list %}
            <tr>
                <td>
                    <a href="{{ team.get_absolute_url }}">{{ team.name }}</a>
                </td>
                <td>{{ team.teammember_set.count }}</td>
                {% if not member_of %}
                    <td>
                        <form method="post"
                              action="{% url 'teams:member-create' site.short_name team.pk %}">
                            {% csrf_token %}
                            <button type="submit"
                                    class="btn btn-xs btn-primary">
                                Join Team
                            </button>
                        </form>

                    </td>
                {% endif %}
            </tr>
        {% endfor %}
        </tbody>
    </table>

    <script type="text/javascript">
        $(document).ready(function () {
            $('#teamsTable').DataTable();
        });
    </script>

{% endblock %}
<!DOCTYPE html>

<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>Title</title>

		<link rel="stylesheet" type="text/css" href="/static/evaluation/upload_widget.css">
		<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
		<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/blueimp-file-upload/9.19.1/js/jquery.fileupload.min.js"></script>
	</head>
	<body>
		<h1>Pretty uploads, yes!</h1>
		<div class="file-upload">
			<form action="." method="POST" enctype="multipart/form-data">
				<input type="file" name="files[]" multiple>
				<div class="upload-bar">
					<div class="label"></div>
				</div>
				<div class="failed-list foldable folded">
					<p>
						<button form="null" onclick="fold_unfold(this)"></button>
						Failed uploads:
						<span class="count">0</span>
					</p>
					<button form="null" class="remove fa fa-remove"></button>
				</div>
			</form>

			<div class="drop-here-floater">
				<div>Drop files here</div>
			</div>
		</div>

		<script type="application/javascript">
			"use strict"

			function fold_unfold(element) {
			    // Find the parent-foldable element
				element = $(element);
				while (!element.hasClass("foldable")) {
				    element = element.parent();
				    if (element.length == 0) {
				        throw Error("No parent element with class 'foldable' found");
                    }
                }
				element.toggleClass("folded");
			}

			function init_upload(element) {
			    element = $(element);
				var failed_files_list = element.find("div.failed-list");

				failed_files_list.find("button.remove").on("click", function(element) {
					failed_files_list.css("display", "none");
					failed_files_list.addClass("folded");
					failed_files_list.find("span.count").text("0");
					failed_files_list.find("div.failed-upload").remove();
				});

				function add_failed_upload(filename, message) {
					failed_files_list.css("display", "block");
					var countSpan = failed_files_list.find("span.count");
					countSpan.text("" + (parseInt(countSpan.text(), 10) + 1));
					failed_files_list.append($("<div class='failed-upload'><p><span class='left'>" + filename + "</span>" + message + "</p></div>"));
				}

				// Tests
				add_failed_upload("test1.txt", "demo error message");
				add_failed_upload("test2.txt", "demo error message");
				add_failed_upload("test3.txt", "demo error message");
			}

			$(function() {
			    var file_uploads = $(".file-upload");
			    for (var i = 0; i < file_uploads.length; i++) {
					init_upload(file_uploads[i]);
				}
			});
		</script>
	</body>
</html>
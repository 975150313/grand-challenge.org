{% extends 'nobanner.html' %}
{% load static %}
{% load url from grandchallenge_tags %}

{% block pageName %}All Challenges{% endblock %}

{% block pagecontent %}

    <h1>All Challenges</h1>

    <p>Here is an overview of all challenges that have been organized within
        the area of medical image analysis that we are aware of. If you know
        any study that would fit in this overview, or want to advertise your
        challenge, please send an email to support@grand-challenge.org and we
        will add the challenge to the list on this page.</p>

    {% if request.user.is_staff %}
        <p>
            <a class="btn btn-primary"
               href="{% url 'challenges:external-create' %}">
                <i class="fas fa-plus"></i> Add an external challenge
            </a>
            <a class="btn btn-primary"
               href="{% url 'challenges:external-list' %}">
                <i class="fas fa-edit"></i> Edit external challenges
            </a>
        </p>
    {% endif %}

    <div id="projectfilterbuttons" class="mt-4">


        <div id="buttonbar" class="alert alert-secondary bg-light">

            <div id="filterby"><h4 class="mt-0 mb-1">Filter by:</h4></div>

            <div id="filter_info">
                <div id="filter_info1">
                    <span id="filter_counter" class="badge badge-info">
                        Active filters:
                        <span class="counter" id="active_filter_count"></span>
                    </span>
                    <button id="btn_reset_filters"
                            class="btn btn-danger btn-sm"
                            value="Reset filters">
                        Reset filters
                    </button>
                </div>
                <div id="filter_info2" style="padding-top: 5px"
                     style="padding-bottom: 5px">
                    <div id="all_active_filters"></div>
                </div>
            </div>

            <div id="projectLinksFilters" style="padding-top: 5px">

                <div id="accordion">

                    <div class="card">
                        <div class="card-header" id="headingChallenge">
                            <h5 class="mb-0">
                                <button class="btn btn-link collapsed"
                                        data-toggle="collapse"
                                        data-target="#collapseChallenge"
                                        aria-expanded="false"
                                        aria-controls="collapseChallenge">
                                    Challenge
                                </button>
                            </h5>
                        </div>

                        <div id="collapseChallenge" class="collapse"
                             aria-labelledby="headingChallenge"
                             data-parent="#accordion">
                            <div class="card-body">
                                <form class="form-inline-challenge">
                                    <!--Hidden checkbox to display all projectlinks by default -->
                                    <label class="checkbox-inline no_indent projectLinkFilter">
                                        <input type="checkbox" class="include"
                                               checked disabled
                                               id="projectlink"
                                               style="display:none;">
                                    </label>

                                    <label id="open"
                                           class="mr-3 checkbox-inline no_indent projectLinkFilter"
                                           title="Show projects that accept new submissions">
                                        <input type="checkbox" class="filter"
                                               id="open"
                                               value="Open for submissions">
                                        <span> Open for submissions </span>
                                        <span
                                                class="counter ml-1 badge badge-pill badge-info"
                                                id="open"></span>
                                    </label>

                                    <label id="datadownload"
                                           class="mr-3 checkbox-inline no_indent projectLinkFilter"
                                           title="Show projects that offer data download">
                                        <input type="checkbox" class="filter"
                                               id="datadownload"
                                               value="Data download">
                                        <span> Data download </span><span
                                            class="counter ml-1 badge badge-pill badge-info"
                                            id="datadownload"></span>
                                    </label>

                                    <label id="grand-challenge"
                                           class="checkbox-inline no_indent projectLinkFilter">
                                        <input type="checkbox" class="filter"
                                               id="grand-challenge"
                                               value="Hosted on Grand-challenge">
                                        <span> Hosted on Grand-challenge </span><span
                                            class="counter ml-1 badge badge-pill badge-info"
                                            id="grand-challenge"></span>
                                    </label>
                                </form>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header" id="headingModality">
                            <h5 class="mb-0">
                                <button class="btn btn-link collapsed"
                                        data-toggle="collapse"
                                        data-target="#collapseModality"
                                        aria-expanded="false"
                                        aria-controls="collapseModality">
                                    Modality
                                </button>
                            </h5>
                        </div>

                        <div id="collapseModality" class="collapse"
                             aria-labelledby="headingModality"
                             data-parent="#accordion">
                            <div class="card-body">
                                <form class="form-inline-modality">
                                    {% for modality in modalities %}
                                        <label id="{{ modality.filter_tag }}"
                                               class="checkbox-inline no_indent projectLinkFilter">
                                            <input type="checkbox"
                                                   class="filter"
                                                   value="{{ modality.modality }}"
                                                   id="{{ modality.filter_tag }}">
                                            <span>{{ modality.modality }}</span><span
                                                class="counter ml-1 badge badge-pill badge-info"
                                                id="{{ modality.filter_tag }}"></span>
                                        </label>
                                    {% endfor %}
                                </form>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header" id="headingTask">
                            <h5 class="mb-0">
                                <button class="btn btn-link collapsed"
                                        data-toggle="collapse"
                                        data-target="#collapseTask"
                                        aria-expanded="false"
                                        aria-controls="collapseTask">
                                    Task type
                                </button>
                            </h5>
                        </div>

                        <div id="collapseTask" class="collapse"
                             aria-labelledby="headingTask"
                             data-parent="#accordion">
                            <div class="card-body">
                                <form class="form-inline-task">
                                    {% for task in task_types %}
                                        <label id="{{ task.filter_tag }}"
                                               class="checkbox-inline no_indent projectLinkFilter">
                                            <input type="checkbox"
                                                   class="filter"
                                                   id="{{ task.filter_tag }}"
                                                   value="{{ task.type }}">
                                            <span>{{ task.type }}</span> <span
                                                class="counter ml-1 badge badge-pill badge-info"
                                                id="{{ task.filter_tag }}"></span>
                                        </label>
                                    {% endfor %}
                                </form>
                            </div>
                        </div>
                    </div>


                    <div Class="card">
                        <div class="card-header" id="headingRegion">
                            <h5 class="mb-0">
                                <button class="btn btn-link collapsed"
                                        data-toggle="collapse"
                                        data-target="#collapseRegion"
                                        aria-expanded="false"
                                        aria-controls="collapseRegion">
                                    Body region and structure
                                </button>
                            </h5>
                        </div>

                        <div id="collapseRegion" class="collapse"
                             aria-labelledby="headingRegion"
                             data-parent="#accordion">
                            <div class="card-body">
                                <div id="accordion1">
                                    {% for r in body_regions %}
                                        <div class="card">
                                            <div class="card-header"
                                                 id="filterbyregion-{{ r.filter_tag }}">
                                                <button class="btn btn-link"
                                                        data-toggle="collapse"
                                                        data-target="#collapseRegion-{{ r.filter_tag }}"
                                                        aria-expanded="true"
                                                        aria-controls="collapseRegion-{{ r.filter_tag }}">
                                                    <label id="{{ r.filter_tag }}"
                                                           class="checkbox-inline no_indent projectLinkFilter">
                                                        <input type="checkbox"
                                                               class="filter"
                                                               id="{{ r.filter_tag }}"
                                                               value="{{ r.region }}">
                                                        <span>{{ r.region }}</span>
                                                        <span
                                                                class="counter ml-1 badge badge-pill badge-info"
                                                                id="{{ r.filter_tag }}"></span>
                                                    </label>
                                                </button>
                                            </div>
                                            <div id="collapseRegion{{ r.filter_tag }}"
                                                 class="collapse show"
                                                 aria-labelledby="filterbyregion-{{ r.filter_tag }}"
                                                 data-parent="#accordion1">
                                                <div class="card-body">
                                                    <form class="form-inline-region-{{ r.filter_tag }}">
                                                        {% for s in body_structures %}
                                                            {% ifequal s.region.filter_tag r.filter_tag %}
                                                                <label id="{{ s.filter_tag }}"
                                                                       class="checkbox-inline no_indent projectLinkFilter">
                                                                    <input type="checkbox"
                                                                           class="filter"
                                                                           id="{{ s.filter_tag }}"
                                                                           value="{{ s.structure }}">
                                                                    <span>{{ s.structure }}</span>
                                                                    <span
                                                                            class="counter ml-1 badge badge-pill badge-info"
                                                                            id="{{ s.filter_tag }}"></span>
                                                                </label>
                                                            {% endifequal %}
                                                        {% endfor %}
                                                    </form>
                                                </div>
                                            </div>
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


                <span id="info" class="badge badge-info">Showing <span
                        class="counter" id="projectlink"></span>
                    projects of <span class="counter" id="total"></span></span>


            </div>
        </div>
    </div>

    <div id='projectlinks'>

        {% for year, challenges in challenges_by_year.items %}

            <div class='projectlinksyearcontainer'>

                <div class='yearHeader' id='{{ year }}'>
                    <h2>{{ year }}</h2>
                </div>

                <div class='row'>
                    {% for challenge in challenges %}
                        <div class="col-12 col-md-6 col-lg-4 mb-3 projectlink {{ challenge.filter_classes|join:" " }} {{ challenge.year }}">
                            <div class="card" style="height:400px">
                                <a id="{{ challenge.short_name }}"
                                   href="{{ challenge.get_absolute_url }}"
                                   style="display:block">
                                    <div class="card-header projectLinkHeading"
                                         style="min-height:110px;">
                                        <div class="projectLinkImage">
                                            <img alt=""
                                                 src="{{ challenge.thumb_image_url }}">
                                        </div>
                                        <div class="projectLinkName">
                                            <h3>
                                                {% firstof challenge.title challenge.short_name %}
                                            </h3>
                                        </div>
                                    </div>
                                </a>

                                <div class="card-body projectLinkBody small"
                                     style="overflow: hidden; height:250px; line-height:1.5em">
                                    {{ challenge.description }}
                                </div>

                                <div class="card-footer small projectLinkFooter"
                                     style="line-height:1.5em">

                                    {% if challenge.is_open_for_submissions %}
                                        <div>
                                            <a href="{{ challenge.get_submission_link }}">Open
                                                for submissions</a>
                                        </div>
                                    {% endif %}

                                    {% if challenge.offers_data_download %}
                                        <div>
                                            <a href="{% firstof challenge.download_page challenge.get_absolute_url %}">Data
                                                download</a>
                                        </div>
                                    {% endif %}

                                    {% if challenge.number_of_submissions %}
                                        <div>
                                            Results: {{ challenge.number_of_submissions }}
                                        </div>
                                    {% endif %}

                                    {% if challenge.last_submission_date %}
                                        <div>
                                            Latest
                                            result: {{ challenge.last_submission_date }}
                                        </div>
                                    {% endif %}

                                    {% if challenge.upcoming_workshop_date %}
                                        <div>
                                            Workshop: {{ challenge.upcoming_workshop_date }}
                                        </div>
                                    {% endif %}

                                    {% if challenge.event_name %}
                                        <div>
                                            Associated with: <a
                                                href="{{ challenge.event_url }}">{{ challenge.event_name }}</a>
                                        </div>
                                    {% endif %}

                                    {% if challenge.publication_journal_name or challenge.publication_url %}
                                        <div>
                                            Article: <a
                                                href="{{ challenge.publication_url }}">{% firstof challenge.publication_journal_name challenge.publication_url %}</a>
                                        </div>
                                    {% endif %}

                                    {% if challenge.get_host_link %}
                                        <div>
                                            Hosted
                                            on: {{ challenge.get_host_link|safe }}
                                        </div>
                                    {% endif %}

                                    {% if not challenge.hosted_on_comic %}
                                        {% if request.user.is_staff %}
                                            <div class="projectLinkEdit">
                                                <a class="btn btn-primary btn-sm"
                                                   href="{% url 'challenges:external-update' challenge.short_name %}">
                                                    <i class="fas fa-edit"></i>
                                                    Edit
                                                </a>
                                                <a class="btn btn-danger btn-sm"
                                                   href="{% url 'challenges:external-delete' challenge.short_name %}">
                                                    <i class="fas fa-trash"></i>
                                                    Delete
                                                </a>
                                            </div>
                                        {% endif %}
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        {% endfor %}
    </div>

    <script type="text/javascript"
            src="{% static "js/challenges/challenge_list_filters.js" %}"></script>

{% endblock %}
